<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Selector Explainer</title>
    <link rel="stylesheet" href="./styles.css" />
    <link
      href="https://fonts.googleapis.com/css?family=Comfortaa&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <main role="main" class="Container">
      <h1>Selectors Explained</h1>
      <form id="form" class="Form">
        <label for="selector" class="Label">â‰ï¸ Selector</label>
        <input
          type="text"
          name="selector"
          id="selector"
          required
          class="Input"
          placeholder="e.g. p.foo a[href]"
          autofocus
          aria-describedby="result"
        />
        <button type="submit" class="Button">Explain âœ¨</button>
      </form>
      <div id="result" class="Result"></div>
    </main>

    <footer role="contentinfo" class="Footer">
      <p>
        &copy; Highly unstable and made with
        <span role="img" aria-label="love">ğŸ’–</span> by
        <a
          href="https://hugogiraudel.com"
          rel="noopener noreferrer"
          target="_blank"
          >Hugo â€œKittyâ€ Giraudel</a
        >
      </p>
    </footer>

    <script src="./bundle.js"></script>
    <script>
      const $form = document.querySelector('#form')
      const $selector = document.querySelector('#selector')
      const $result = document.querySelector('#result')

      const capitalise = value =>
        value.slice(0, 1).toUpperCase() + value.slice(1)

      const asHTML = value =>
        value
          // Make sure tag names are properly displayed and not rendered as HTML
          .replace(/</g, 'â€˜&lt;')
          .replace(/>/g, '&gt;â€™')

          // Wrap emphases with <code> elements for clarity
          .replace(/â€˜/g, '<code>')
          .replace(/â€™/g, '</code>')

          // Insert line breaks for readability
          .replace(/([^yf]) within/g, (...args) => `${args[1]}<br>â€¦ within`)
          .replace(/([^y]) after/g, (...args) => `${args[1]}<br>â€¦ after`)
          .replace(/element of/g, 'element<br>â€¦ of')
          .replace(/itself/g, '<br>â€¦ itself')
          .replace(/([^f]) directly/g, (...args) => `${args[1]}<br>â€¦ directly`)

      const asSentence = value => capitalise(value) + '.'

      form.addEventListener('submit', event => {
        // Prevent page refresh
        event.preventDefault()

        let results = null

        // Empty the current result container
        $result.innerHTML = ''

        try {
          results = explain(selector.value)
        } catch (error) {
          // Display an error in case of exception
          const $p = document.createElement('p')
          $p.innerText = asSentence(error.message)
          $result.appendChild($p)
        }

        if (results.length === 1) {
          const $p = document.createElement('p')
          $p.innerHTML = asHTML(asSentence(results[0]))
          $result.appendChild($p)
        } else {
          const $ol = document.createElement('ol')
          results.forEach(result => {
            const $li = document.createElement('li')
            $li.innerHTML = asHTML(asSentence(result))
            $ol.appendChild($li)
          })
          $result.appendChild($ol)
        }
      })
    </script>
  </body>
</html>
